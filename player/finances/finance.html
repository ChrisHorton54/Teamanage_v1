<!DOCTYPE html>
<html>
  <head>
    <title>TeaManage</title>
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="../../css/style.css" />
    <script type="text/javascript" src="../../js/jquery-1.11.2.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        // Wait for PhoneGap to load     
        document.addEventListener("deviceready", onDeviceReady, false);
        
        // PhoneGap is ready
        function onDeviceReady() {
        }
        
        window.onload = function(){
            $('#name').html(localStorage.getItem('player_name'));
            $(".menu").click(function(){
                $("#popup-nav").fadeToggle("slow");
            });
            retrievePlayerFin();
        }
    </script>
       <!-- The required Stripe lib -->
      <script type="text/javascript" src="https://js.stripe.com/v2/"></script>

      <!-- jQuery is used only for this example; it isn't required to use Stripe -->
      <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

      <script type="text/javascript">
        // This identifies your website in the createToken call below
        Stripe.setPublishableKey('pk_test_wDUZqZtwcNTFzgK0WYGV86wg');

        var stripeResponseHandler = function(status, response) {
          var $form = $('#payment-form');

          if (response.error) {
            // Show the errors on the form
            $form.find('.payment-errors').text(response.error.message);
            $form.find('button').prop('disabled', false);
          } else {
            // token contains id, last4, and card type
            var input = response.id;
            var payment = $("#fines-payment-amount").html();
            var email = "Payment from email: chris@teamanage.co.uk for Fines";
            var stripe_sk = "sk_test_dxCYhaHeac7NhTMVAK4RvIPd";
            
            $.ajax({
                url:"http://teamanage.co.uk/stripe/charge.php",
                type: "POST",
                data: {stripeToken : input, payment: payment, email: email, stripe_sk: stripe_sk},
                success:function(data){
                    checkPayment(data);
                }
            });
          }
        };

        jQuery(function($) {
          $('#payment-form').submit(function(e) {
            var $form = $(this);

            // Disable the submit button to prevent repeated clicks
            $form.find('button').prop('disabled', true);

            Stripe.card.createToken($form, stripeResponseHandler);

            // Prevent the form from submitting with the default action
            return false;
          });
        });
      </script>
  </head>
  <body>
      <img src="../../img/background.jpg" id="background" alt="background">
      <header>
        <img class="menu" src="../../img/menu.png" alt="Menu" title="Menu" />
        <h2 id="name">Player</h2>
        <div id="popup-nav">
            <div id="popup-nav-content">
                <img src="../../img/arrow-head.png" class="arrow-head" title="Arrow Head" alt="Arrow Head" />
                <a href=""><div class="nav-block first">
                        <img src="../../img/squad-nav.jpg" title="Squad" alt="Squad" />
                        <h3>Squad</h3>
                    </div></a> 
                <a href=""><div class="nav-block second">
                        <img src="../../img/events-nav.jpg" title="Events" alt="Events" />
                        <h3>Events</h3>
                    </div></a> 
                <a href=""><div class="nav-block third">
                        <img src="../../img/finances-nav.jpg" title="Finances" alt="Finances" />
                        <h3>Finances</h3>
                    </div></a>
                <div class="clear"></div>
                <a href=""><div class="nav-block first">
                        <img src="../../img/doc-nav.jpg" title="Documents" alt="Documents" />
                        <h3>Documents</h3>
                    </div></a> 
                <a href=""><div class="nav-block second">
                        <img src="../../img/stats-nav.jpg" title="Stats" alt="Stats" />
                        <h3>Stats</h3>
                    </div></a>
                <a href=""><div class="nav-block third">
                        <img src="../../img/gallery-nav.jpg" title="Gallery" alt="Gallery" />
                        <h3>Gallery</h3>
                    </div></a>
                <div class="clear"></div>
                <a href=""><div class="nav-block first">
                        <img src="../../img/fantalk-nav.jpg" title="Fan Talk" alt="Fan Talk" />
                        <h3>Fan Talk</h3>
                    </div></a>
                <div class="nav-block second log-out">
                        <img src="../../img/fantalk-nav.jpg" title="Log Out" alt="Log Out" />
                        <h3>Log Out</h3>
                    </div>
            </div>
        </div>
      </header>
      <div class="section">
          <h2>Your Finances</h2>
          <div class="clear"></div>
        <div class="section-body">
            <div class="section-content">
                <img id="fin-player-image" src="../../img/gallery-nav.jpg" />
                <div id="finance-info">
                    <h3>Player Name</h3>
                    <p>Position</p>
                </div>
                <div class="clear"></div>
            </div>
        </div>
      </div>
      <div class="clear"></div>
      <div class="section">
          <h2>Subs Owed</h2>
          <div class="clear"></div>
        <div class="section-body">
            <div class="section-content">
                <div class="subs-fines">
                    <h2>&pound;<span id="subs-amount"></span></h2>
                    <p id="subs-payment-amount" style="display:none;"></p>
                    <script src="https://checkout.stripe.com/v2/checkout.js"></script>
                    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js"></script>
                    <button id="customButtonSubs" class="submit">Pay Subs</button>
                    <div class="clear"></div>
                </div>
            </div>
        </div>
      </div>
      <div class="clear"></div>
      <div class="section">
          <h2>Fines Owed</h2>
          <div class="clear"></div>
        <div class="section-body">
            <div class="section-content">
                <div class="subs-fines">
                    <h2>&pound;<span id="fines-amount"></span></h2>
                    <p id="fines-payment-amount" style="display:none;"></p>
                    <form action="" method="POST" id="payment-form">
                      <span class="payment-errors"></span>

                      <div class="form-row">
                        <label>
                          <span>Card Number</span>
                          <input type="text" size="20" data-stripe="number"/>
                        </label>
                      </div>

                      <div class="form-row">
                        <label>
                          <span>CVC</span>
                          <input type="text" size="4" data-stripe="cvc"/>
                        </label>
                      </div>

                      <div class="form-row">
                        <label>
                          <span>Expiration (MM/YYYY)</span>
                          <input type="text" size="2" data-stripe="exp-month"/>
                        </label>
                        <span> / </span>
                        <input type="text" size="4" data-stripe="exp-year"/>
                      </div>

                      <button type="submit">Submit Payment</button>
                    </form>
                    <div class="clear"></div>
                </div>
            </div>
        </div>
      </div>
      <div class="clear"></div>
      <div class="section">
          <h2>Recent Payments</h2>
          <div class="clear"></div>
        <div class="section-body">
            <div class="section-content">
                <a href="#" class="submit"><p>View Payments</p></a>
                <div class="clear"></div>
            </div>
        </div>
      </div>
      <script type="text/javascript" src="../../js/teamanage.js"></script>
      <script type="text/javascript" src="../../js/finances/play-finances.js"></script>
      <script type="text/javascript" src="phonegap.js"></script>
      <script type="text/javascript" src="cordova.js"></script>
  </body>
</html>